Theblack-boxcomplexityofnearestneighborsearch∗RobertKrauthgamer†JamesR.Lee‡January25,2005AbstractWedefineanaturalnotionofefficiencyforapproximatenearest-neighbor(ANN)searchingeneraln-pointmetricspaces,namelytheexistenceofdesirabletoaddressNNSingeneralmetricspaces.Ontheotherhand,datastructuresforgeneralmetricsmightperformanearestneighborqueryintimeaspoorlyasΩ(n)whichisunacceptableinpractice.Suchadependenceisinherentevenwhenonlyapproximatesolutionsarerequired.Awell-knownexampleiswhereXformsauniformmetric,sothattheinterpointdistancesinXareallequal,providingthepreprocessingstepwithessentiallynoinformation.Metricdimension.Giventhisstateofaffairs,anincreasingamountofrecentattentionhasfocusedonunderstandingthecomplexityofNNSintermsofametric’simplicitstructure.InEuclideanspaces,anobviousandcommonmeasureforametric’scomplexityisthedimensionoftheEuclideanhostspace.Thusitisnaturalthattocharacterizethecomplexityof2n2148(a)Thedoublingline(b)MixtureofGaussiansintheplaneFigure1:ClusteredpointsetsspaceXadmitsanefficient(1+ε)-ANNschemeifthereexistsa(possiblyrandomized)algorithmwhichanswerswearenotreducingtotheproblemofpointlocationinequalballs.Hencewemustshowthatforlow-dimensionalmetrics,ringseparatorsexistunconditionally.)Usingtheseseparators,webuildabinarydecisiontreeofheight2O(dim(X))lognwhichcanbeusedtoanswerO(1)-ANNqueriesintime2O(dim(X))logn.Unfortunately,thenaturalimplementationofthistreerequiresspacen2O(dim(X)),whichisnΩ(polylog(n))evenwhendim(X)=Θ(loglogn).Thisexponentialblow-upinspaceisatypicalproblemencounteredinNNSalgorithmsbasedonmetricdecompositions,andisthemostdifficulttechnicalchallengefacedbythepresentwork.InSection3.2,weovercomethisproblemforlow-dimensionalmetrics,obtainingadatastructurethatusesO(n3)spacewheneverdim(X)=O(loglogn).Inaddition,evenforarbitraryn-pointmetrics(withnoboundonthedimension),thespaceconsumptionisonlypolynomialinn.Thisimprovementrequiresasecondnewtechniquewhichamountsto“folding”thedecisiontreebackontoitself,oftenmergingmanyapparentlydistinctbranchesintotheopenballofradiusraboutxinS.WhenS=X,weomitthesubscriptS.Wewrited(x,S)=infy∈Sd(x,y).Definediam(S)=supx,y∈Sd(x,y),andlettheaspectratiopreprocessingtimeorspace,butwenotethatinallofourupperbounds,botharelinearinthespaceusedbythealgorithmforansweringaquery.Asfortherunningtime,wenotethatallofthealgorithmsin[Cla99,KR02,KL04]striveforpolylog(n)querytimes,thusitisthenaturalcandidatefor“efficiency.”WealsonotethatthebestalgorithmsforANNinhigh-dimensionalEuclideanspacesanswerqueriesinpolylog(n)time[IM98,KOR98,HP01].Asforspace,poly(n)isagainthenaturalProof.LetkbetheleastnumberforwhicheverysubsetS⊆XwithΦ(S)≤Φ0satisfiesthebound|S|≤k.TheneveryballB(x,12Φ0r)canbecoveredbykballsNowweprovethemaintheoremofthissection.ProofofTheorem2.1.Let(X,d)beanymetricspace.NotethatasΦ0→2inLemma2.2,thelowerboundvalueofεtowhichtheprecedingtheoremappliesbehaveslikeε<(Φ0+12)−1→25.Thusforanyfixedε<25,thereisalowerboundof2Ω(dim(X))onthenumberofcallstothedistancefunctionwhichareneeded3EfficientalgorithmsWeprovidetwoalgorithmsfor(1+ε)-approximatenearestneighborsearchinageneralmetricspace;thetwohavesimilarquerytime,buttheydifferintheirspacerequirement.BythegeneralreductiondiscussedinSection1.2,itsufficestoexhibitanO(1)-ANNalgorithm.Ourfirstalgorithm(Section3.1)isbasedontheexistenceofacertainring-separator,whichnaturallyyieldsabinarydecisiontreethatcanbeusedtosolve3-ANN.Thedecisiontree’sdepthis2O(dim(X))logn,sothisThering-separatortree.Giventheabovelemma,itisnaturaltodefineaδ-ring-separatortreeforametricspace(X,d).ThisisabinarytreewhereeachnodehasalabelS⊆X,constructedrecursivelyasfollows.TherootofthetreehasthelabelS=X.AnodelabeledbySisaleafif|S|=1,andhastwochildrenif|S|≥2.Inthelattercase,wetake(x,R)tobeaδ-ring-separatorofSandadddistinctradiithatareusedbythering-separatorsinthedatastructure.Second,weeliminatealtogethertheoutsidechildren,essentiallyreplacingeachonebysufficientlymanyinsidechildren(i.e.,balls).Theadvantageinhavingonlyinsidechildrenisthatnowifapathinthetree(sequenceofinsidechildren)correspondstoproperlynestedballs,thentheinformationintheentiresequencemayberepresentedbyasingleball(namely,thelastone,consideredasaballinX).Andindeed,thekeyideainthethirdstepistomaintaintheinvariantthatwheneverwegotoaninsidechildcorrespondingtoaballBX(y,2R),itholdsthatd(y,q)≤βRforasuitableconstant1<β<2.Thisinvariantisusedtoensurethatx2ttFigure2:BallsB(y,t/2)formingthefirstfamilyofinsidechildren.xt94R34RFigure3:BallsB(y,R/4)formingthesubcaseR=2tofthesecondfamilyofinsidethemasthefollowingparametersα=32,β=98,andγ=54.Thedirectededgesleavingavertexhy,Riareasfollows.IfthesetS=BX(y,2R)associatedwiththevertexcontainsonlyonepoint,thenthisvertexhy,Rihasnooutgoingedges.Otherwise,let(x,t)beanenhancedδ-ring-separatorforS,asguaranteedbyLemma3.4.Noticethatthering-separatorimpliesthatScontainstwopointsatleastt•Ifd(x,q)>2t,wecomputethevalueR0whichisapowerof2suchthatR0<d(x,q)≤2R0,andexaminefamily(b)ofoutgoingedgesofhy,Ri.IfLetjbethelargest(i.e.,lastvertexinthetraversal)suchthata∗∈BX(yj,γRj).Thisjiswell-definedbecauseforthefirstvertexinthetraversalwehaveγR1=γR̂≥diam(X).Wecanruleouttwocasesthatareeasytohandle.First,if|Sj|=1,thensincea∗∈BX(yj,γRj)⊆Sj,thetraversalmustendathyDuetoties,thenextvertexintheDAGtraversal,hyj+1,Rj+1i,doesnothavetobehy0,R0/32i.Butbydefinition,Rj+1=R0/32andd(yj+1,ATriangleinequalityforthelowerboundLemmaA.1.Foreveryi∈{1,...,k},thespace(X∪{qi},d)satisfiesthetriangleinequality.Proof.Fixx,y∈X.Weneedtoverifythatalltriangleinequalitiesonq,x,yaresatisfied,i.e.,thatd(x,y)≤d(x,q)+d(q,y)and|d(x,q)−d(y,q)|≤d(x,y).Toeasenotation,letS0={x∈X:d(x,S)≤126.x∈S0\B(xi,12dmin),y/∈S0:qBAEQ1EQ2xyPSfragreplacementsxyqF+12dminF+d(y,S)(y,S)=