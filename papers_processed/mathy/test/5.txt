GaussianProcessOptimizationintheBanditSetting:NoRegretandExperimentalDesignNiranjanSrinivasCaliforniaInstituteofTechnologyniranjan@caltech.eduAndreasKrauseCaliforniaInstituteofTechnologykrausea@caltech.eduShamM.KakadeUniversityofPennsylvaniaskakade@wharton.upenn.eduMatthiasSeegerSaarlandUniversitymseeger@mmci.uni-saarland.deAbstractManyapplicationsrequireoptimizinganun-known,noisyfunctionthatisexpensivetoevaluate.Weformalizethistaskasamulti-armedbanditproblem,wherethepayofffunctioniseithersampledfromaGaussianprocess(GP)orhaslowRKHSnorm.Weresolvetheimpor-tantopenproblemofderivingregretboundsforthissetting,whichimplynovelconvergenceratesforGPoptimization.WeanalyzeGP-UCB,anintuitiveupper-confidencebasedalgorithm,andbounditscumulativeregretintermsofmaximalinformationgain,establishinganovelconnectionbetweenGPoptimizationandexperimentalde-sign.Moreover,byboundingthelatterintermsofoperatorspectra,weobtainexplicitsublinearregretboundsformanycommonlyusedcovari-ancefunctions.Insomeimportantcases,ourboundshavesurprisinglyweakdependenceonthedimensionality.Inourexperimentsonrealsensordata,GP-UCBcomparesfavorably(alsoseeAuer2002;Danietal.2007;Abernethyetal.2008;Rusmevichientong&Tsitsiklis2008),explicitlydependentonthedimensionality.IntheGPsetting,thechallengeistocharacterizecomplexityinadiffer-entmanner,throughpropertiesofthe2.1.GaussianProcessesandRKHS’sGaussianProcesses.Someassumptionsonfarerequiredtoguaranteeno-regret.Whilerigidparamet-ricassumptionssuchaslinearitymaynotholdinprac-tice,acertaindegreeofsmoothnessisoftenwarranted.Inourtionoptimization.Forthelatter,weonlyneedtoiden-tifypointsxwheref(x)islarge,inordertoconcen-tratesamplingthereasrapidlyaspossible,thusexploitourknowledgeaboutmaxima.Infact,theEDrule010203040010203040152025Temperature(C)(a)Temperaturedata−6−4−20246−5−4−3−2−1012345(b)Iterationt−6fromaGPpriorandthatthenoiseisN(0,σ2)withknownvarianceσ2.WenowanalyzeGP-UCBinanagnosticsetting,wherefisanarbitraryfunctionfromtheRKHScorrespondingtokernelk(x,x0).Moreover,weallowthenoisevariablesεttobeanar-bitrarymartingaledifferencesequence(meaningthatE[εt|ε<t]=0forallt∈N),uniformlyboundedbyσ.NotethatwestillrunthesameGP-UCBalgorithm,whosepriorandnoisemodelaremisspecifiedinthiscase.OurfollowingresultshowsthatGP-UCBattainssublinearregretevenintheagnosticsetting.Theorem3Letδ∈(0,1).AssumethatthetrueunderlyingfliesintheRKHSHk(D)correspondingtothekernelk(x,x0),andthatthenoiseεthaszeromeanconditionedonthehistoryandisboundedbyσalmostsurely.Inparticular,assumekfk2k≤Bandletβt=2B+300γt5101520051015EigenvaluerankEigenvalueIndependentMatern(ν=2.5)SquaredexponentialLinear(d=4)1020304050050100150200250TBoundonγTLinear(d=4)IndependentMaternSquaredexponentialFigure3.Spectraldecay(left)andinformationgainbound(right)forindependent(diagonal),linear,squaredexponentialandMatérnkernels(ν=2.5.)withequaltrace.Finitedimensionallinearkernelshavetheformk(x,x0)=xTx0.GPswith00.20.40.60.81−4−20246(a)BayesianLinearRegression00.20.40.60.81−2−1012(b)SquaredExponential00.20.40.60.81−2−101analysisofthemultiarmedbanditproblem.Mach.Learn.,47(2-3):235–256,2002.Brochu,E.,Cora,M.,anddeFreitas,N.AtutorialonBayesianoptimizationofexpensivecostfunctions,withapplicationtoactiveusermodelingandhierarchicalre-inforcementlearning.InTR-2009-23,ProofFixt≥1andx∈D.Conditionedonyt−1=(y1,...,yt−1),{x1,...,xt−1}aredeterministic,andf(x)∼tintheanalysis.Essentially,weusethistoobtainavalidconfidenceintervalonx∗.Thefollowinglemmaprovidesaconfidenceboundforthesesubsets.Lemma5.6Pickδ∈(0,1)andsetβt=statesthatifderivativesuptofourthorderexistsfor(x,x0)7→k(x,x0),thenfisalmostsurelycon-tinuouslydifferentiable,with∂f/(∂xj)distributedasGaussianprocessesagain.Moreover,thereProofWehavethatmin{r,α}≤(α/log(1+α))log(1+r).ThestatementfollowsfromLemma5.3.ThenextlemmaboundsthegrowthofZT.Itisfor-mulatedintermsofnormalizedquantities:eonthestepsizesofourmartingale.|Mt|=2|eεt|Et−1|eµt−1−ef(xt)|1+eσ2t−1≤2|eεt|Et−1β1/2teσt−11+eσ2t−1≤2|eεt|Et−1β1/2tmin{eσt−1,1/2},(12)wherethefirstinequalityfollowsfromthedefinitionofEt.Moreover,r/(1+r2)≤min{r,1/2}forr≥0.Therefore,|Mt|≤β1/2T,since|eεt|≤1andβtinnonde-creasing.Next,weboundthesumoftheconditionalvariancesofthemartingale:VT:=XTt=1Var(Mt|M1...Mt−1)≤XTt=14|eεt|2Et−1βtmin{eσ2t−1,1/4}≤4βTXTt=1Et−1min{eσ2t−1,1/4}|eεt|≤1≤9βTγT.Inthelastline,weusedLemma7.1withα=1/4,not-ingthat8α/log(1+α)≤9.Sincewehaveestablishedthatthesumofconditionalvariances,VT,isalwaysboundedby9βTγT,wecanapplyTheorem7withpa-rametersa=βT+1/2,b=β1/2T+1andv=9βTγTtogetPrXTt=1Mt≥βT+1/2=PrXTt=1Mt≥βT+1/2andVT≤9βTγT≤exp−(βT+1/2)22(9βTγT)+23(βT+1/2)β1/2T+1!=exp−βT+172γT+43β1/2T+1!≤max(exp−βT+1144γT,exp−3β1/2T+18!).NotethatourchoiceofβT+1satisfies:maxn144γTlog(T2/δ),(8/3)log(T2/δ)2o≤βT+1.Therefore,thepreviousprobabilityisboundedbyδ/T2,whereasthelastinequalityfollowsfromthedef-initionofβT+1.Withafinalapplicationoftheunionbound:PrXTt=1Mt≥βT+1/2forsomeT≤XT≥1PrXTt=1Mt≥βT+1/2≤XT≥2δ/T2≤δ(π2/6−1)≤δ,completingtheproofofLemma7.3.C.BoundsonInformationGainInthissection,weshowhowtoboundγT,themax-imuminformationgainafterTrounds,forcompactD⊂Rd(assumptionsofTheorem2)andseveralcom-monlyusedcovariancefunctions.Inthissection,weassume4thatk(x,x)=1forallx∈D.Theplanofattackisasfollows.First,wenotethattheargumentofγT,I(yA;fA)isasubmodularfunction,soγTcanbeboundedbythevalueobtainedbygreedymaximization.Next,weuseadiscretizationDT⊂DwithnT=|DT|=Tτwithnearestneighbourdistanceo(1),considerthekernelmatrixKDT∈RnT×nT,andboundγTbyanexpressioninvolvingtheeigenvalues{λ̂t}ofthismatrix,whichisdonebyafurtherre-laxationofthegreedyprocedure.Finally,weboundthisempiricalexpressionintermsofthekernelopera-toreigenvaluesofkw.r.t.theuniformdistributiononD.AsymptoticexpressionsforthelatterarereviewedinSeegeretal.(2008),whichweplugintoobtainourresults.AkeystepinthisargumentistoensuretheexistenceofadiscretizationDT,forwhichtailsoftheempiricalspectrumcanbeboundedbytailsoftheprocessspectrum.Wewillinvoketheprobabilisticmethodforthat.C.1.GreedyMaximizationandDiscretizationInthissection,wefixT∈NandassumetheexistenceofadiscretizationDT⊂D,nT=|DT|ontheorderofTτ,suchthat:∀x∈D∃[x]T∈DT:kx−[x]Tk=O(T−τ/d).(13)WecomebacktothechoiceofDTbelow.WerestricttheinformationgaintosubsetsA⊂DT:γ̃T=maxA⊂DT,|A|=TI(yA;fA).Ofcourse,γ̃T≤γT,butwecanboundtheslack.4Withoutlossingenerality.Weusethisassumptionbelowtoensurethatn−1TtrKDT=Rk(x,x)dx.Ifk(x,x)isnotconstant,thisisapproximatelytruebythelawoflargenumbers,Lemma7.4UndertheassumptionsofTheorem2,theinformationgainFT({xt})=(1/2)log|I+σ−2K{xt}|isuniformlyLipschitz-continuousineachcomponentxt∈D.ProofTheassumptionsofTheorem2implythatthekernelK(x,x0)iscontinuouslydifferentiable.TheresultfollowsfromthefactthatFT({xt})iscontinuouslydifferentiableinthekernelmatrixK{xt}.Lemma7.5LetDTbeadiscretizationofDsuchthat(13)holds.UndertheassumptionsofTheorem2,wehavethat0≤γT−γ̃T=O(T1−τ/d).ProofFixT∈N,andletA={x1,...,xT}beamaximizerforγT.Considerneighbours[xt]T∈DTaccordingto(13),[A]T={[xt]T}.Then,0≤γT−γ̃T≤γT−I(y[A]T;f[A]T)=FT(A)−FT([A]T),whereFT({xt})=(1/2)log|I+σ−2K{xt}|.ByLemma7.4,FTisuniformlyLipschitz-continuousineachcomponent,sothat|γT−I(y[A]T;f[A]T)|=O(Tmaxtkxt−[xt]Tk)=O(T1−τ/d)by(13)andthemeanvaluetheorem.Weconcentrateonγ̃Tinthesequel.LetKDT=[k(x,x0)]x,x0∈DTbethekernelmatrixovertheen-tireDT,andKDT=UΛ̂UTitseigendecomposi-tion,withλ̂1≥λ̂2≥···≥0andU=[u1u2...]orthonormal.Here,ifT>nT,defineλ̂t=0fort=nT+1,...,T.InformationgainmaximizationoverafiniteDTcanbedescribedintermsofasim-plelinear-Gaussianmodelovertheunknownf∈RnT,withpriorP(f)=N(0,KDT)andlikelihoodpoten-tialsP(yt|f)=N(vTtf,σ2)withunit-normfeatures,kvtk=1.Withthefollowinglemma,weupper-boundγ̃Tbywayoftworelaxations.Lemma7.6ForanyT≥1,wehavethatγ̃T≤1/21−e−1maxm1,...,mTXTt=1log(1+σ−2mtλ̂t),subjecttomt∈N,PtmT=T,whereλ̂1≥λ̂2≥...isthespectrumofthekernelmatrixKDT.Here,ifT>nT,thenmt=0fort>nT.ProofAsshownbyKrause&Guestrin(2005),thefunctionF(A)=I(yA;f)issubmodular.Intheparticularcaseconsideredhere,thiscanbeseenasfollows:F(A)=H(yA)−H(yA|f),wheretheentropyH(yA)isa(not-necessarilymonotonic)submodularfunctioninA,andsincethenoiseisconditionallyindependentgivenf,H(yA|f)isanadditive(modular)functioninA.Subtractingamodularfunctionpreservessubmodularity,thusF(A)issubmodular.Furthermore,theinformationgainismonotonicinA(i.e.,F(A)≤F(B)wheneverA⊆B)(Cover&Thomas,1991).Thus,wecanapplytheresultofNemhauseretal.(1978)5whichguaranteesthatγ̃Tisupper-boundedby1/(1−1/e)timesthevaluethegreedymaximizationalgorithmattains.Thelatterchoosesfeaturesoftheformvt=δxt=[I{x=xt}]ineachround,xt∈DT.Weupper-boundthegreedymaximumoncemorebyrelaxingtheseconstraintstokvtk=1only.Intheremainderoftheproof,weconcentrateonthisrelaxedgreedyprocedure.Supposethatuptoroundt,itchosev1,...,vt−1.TheposteriorP(f|yt−1)hasinversecovariancematrixΣ−1t−1=K−1DT+σ−2Vt−1VTt−1,Vt−1=[v1...vt−1],andthegreedyprocedureselectsvsotomaximizethevariancevTΣt−1v:theeigenvectorcorrespondingtoΣt−1’slargesteigenvalue(bytheRayleigh-Ritztheorem).SinceΣ0=KDT,thenv1=u1.Moreover,ifallvt0,t0<t,havebeenchosenamongU’scolumns,thenbytheinversecovarianceexpressionjustgiven,KDTandΣt−1havethesameeigenvectors,sothatvtisacolumnofUaswell.Forexample,ifvt=uj,thencomparingΣt−1andΣt,alleigenvaluesotherthanthej-thremainthesame,whilethelatterisshrunk.Therefore,afterTroundsoftherelaxedgreedyprocedure:vt∈{u1,...,umin{T,nT}},t=1,...,T:atmosttheleadingTeigenvectorsofKDTcanhavebeenselected(possiblymultipletimes).Ifmtdenotesthenumberthatthet-thcolumnofUhasbeenselected,weob-tainthetheoremstatementbyafinalboundingstep.C.2.FromEmpiricaltoProcessEigenvaluesThefinalstepwillbetorelatetheempiricalspec-trum{λ̂t}tothekerneloperatorspectrum.Sincelog(1+σ−2mtλ̂t)≤σ−2mtλ̂tinTheorem7.6,wewillmainlybeinterestedinrelatingthetailsumsofthespectra.Letµ(x)=V(D)−1I{x∈D}betheuniformdistributiononD,V(D)=Rx∈Ddx,andassumethatkiscontinuous.NotethatRk(x,x)µ(x)dx=1byourassumptionk(x,x)=1,sothatkisHilbert-5WhiletheresultofNemhauseretal.(1978)isstatedintermsoffinitesets,itextendstoinfinitesetsaslongasthegreedyselectioncanSchmidtonL2(µ).Then,Mercer’stheorem(Wahba,1990)statesthatthecorrespondingkerneloperatorhasadiscreteeigenspectrum{(λs,φs(·))},andk(x,x0)=Xs≥1λsφs(x)φs(x0),whereλ1≥λ2≥···≥0,andEµ[φs(x)φt(x)]=δs,t.Moreover,Ps≥1λ2s<∞,andtheexpan-sionofkconvergesabsolutelyanduniformlyonD×D.NotethatPs≥1λs=Ps≥1λsEµ[φs(x)2]=RK(x,x)µ(x)dx=1.InordertoproceedfromThe-orem7.6,wehavetopickadiscretizationDTforwhich(13)holds,andforwhichPt>T∗λ̂tisnotmuchlargerthanPt>T∗λt.Withthefollowinglemma,wedeter-minesizesnTforwhichsuchdiscretizationsexist.Lemma7.7FixT∈N,δ>0andε>0.ThereexistsadiscretizationDT⊂DofsizenT=V(D)(ε/√d)−d[log(1/δ)+dlog(√d/ε)+logV(D)]whichfulfilsthefollowingrequirements:•ε-denseness:Foranyx∈D,thereexists[x]T∈DTsuchthatkx−[x]Tk≤ε.•Ifspec(KDT)={λ̂1≥λ̂2≥...},thenforanyT∗=1,...,nT:n−1TXT∗t=1λ̂t≥XT∗t=1λt−δ.ProofFirst,ifwedrawnTsamplesx̃j∼µ(x)in-dependentlyatrandom,thenDT={x̃j}isε-densewithprobability≥1−δ.Namely,coverDwithN=V(D)(ε/√d)−dhypercubesofsidelengthε/√d,withinwhichthemaximumEuclideandistanceisε.Theprobabilityofnothittingatleastonecellisupper-boundedbyN(1−1/N)nT.Sincelog(1−1/N)≤−1/N,thisisupper-boundedbyδifnT≥Nlog(N/δ).Now,letS=n−1TPT∗t=1λ̂t.Shawe-Tayloretal.(2005)showthatE[S]≥PT∗t=1λt.IfCistheevent{DTisε−dense},thenPr(C)≥1−δ.SinceS≤n−1TtrKDT=1inanycase,wehavethatE[S|C]≥E[S]−Pr(Cc)≥PT∗t=1λt−δ.Bytheprobabilisticmethod,theremustexistsomeDTforwhichCandthelatterinequalityholds.Thefollowinglemma,theequivalentofTheorem4inthecontexthere,isadirectconsequenceofLemma7.6.Lemma7.8LetDTbesomediscretizationofD,nT=|DT|.Then,foranyT∗=1,...,min{T,nT}:γ̃T≤1/21−e−1maxr=1,...,TT∗log(rnT/σ2)+(T−r)σ−2XnTt=T∗+1λ̂t.ProofWesplittherighthandsideinLemma7.6att=T∗.Letr=Pt≤T∗mt.Fort≤T∗:log(1+mtλ̂t/σ2)≤log(rnT/σ2),sinceλ̂t≤nT.Fort>T∗:log(1+mtλ̂t/σ2)≤mtλ̂t/σ2≤(T−r)λ̂t/σ2.Thethere,thesamedecayrateholdsforλsw.r.t.uniformµ(x),whileconstantsmightchange.Inhindsight,itturnsoutthatτ=distheoptimalchoiceforthediscretizationsize,renderingthesecondterminThe-orem5tobeO(1),whichissubdominantandwillbeneglectedinthesequel.Wehavethatλs≤cBs1/dwithB<1.Followingtheiranalysis,Bk(T∗)≤c(d!)α−de−βXd−1j=0(j!)−1βj,whereα=−logB,β=αT1/d∗.Therefore,Bk(T∗)=O(e−ββd−1),β=αT1/d∗.WehavetopickT∗suchthate−βisnotmuchlargerthan(TnT)−1.SupposethatT∗=[log(TnT)/α]d,sothate−β=(TnT)−1,β=log(TnT).Theboundbe-comesmaxr=1,...,TT∗log(rnT/σ2)+σ−2(1−r/T)(C5βd−1+C4(logT))withnT=C4Td(logT).Thefirstpartdominates,sothatr=TandγT=O([log(Td+1(logT))]d+1)=O((logT)d+1).ThisshouldbecomparedwithE[I(yT;fT)]=O((logT)d+1)givenbySeegeretal.(2008),wherethextaredrawnindependentlyfromaGaussianbasedistribution.AtleastrestrictedtoacompactsetD,weobtainthesameexpressiontoleadingorderformax{xt}I(yT;fT).MatérnKernelsForMatérnkernelskwithroughnessparameterν,Bk(T∗)isgivenbySeegeretal.(2008)fortheuni-formbasedistributionµ(x)onD.Namely,λs≤cs−(2ν+d)/dforalmostalls∈N,andBk(T∗)=O(T1−(2ν+d)/d∗).Tomatchtermsintheγ̃Tbound,wechooseT∗=(TnT)d/(2ν+d)(log(TnT))κ(κchosenbelow),sothattheboundbecomesmaxr=1,...,TT∗log(rnT/σ2)+σ−2(1−r/T)×(C5T∗(log(TnT))−κ(2ν+d)/d+C4(logT))+O(T1−τ/d)withnT=C4Tτ(logT).Forκ=−d/(2ν+d),weob-tainthatthemaximumoverrisO(T∗log(TnT))=O(T(τ+1)d/(2ν+d)(logT)).Finally,wechooseτ=2νd/(2ν+d(d+1))tomatchthistermwithO(T1−τ/d).Pluggingthisin,wehaveγT=O(T1−2η(logT)),η=ν2ν+d(d+1).TogetherwithTheorem2(forν>2),wehavethatRT=O∗(T1−η)(suppressinglogfac-tors):foranyν>2andanydimensiond,theGP-UCBalgorithmisguaranteedtobeno-regretinthiscasewitharbitrarilyhighprobability.HowdoesthisboundcomparetotheboundonE[I(yT;fT)]givenbySeegeretal.(2008)?Here,γT=O(Td(d+1)/(2ν+d(d+1))(logT)),whileE[I(yT;fT)]=O(Td/(2ν+d)(logT)2ν/(2ν+d)).LinearKernelForlinearkernelsk(x,x0)=xTx0,x∈Rdwithkxk≤1,wecanboundγTdirectly.LetXT=[x1...,xT]∈Rd×Twithallkxtk≤1.Now,log|I+σ−2XTTXT|=log|I+σ−2XTXTT|≤log|I+σ−2D|withD=diagdiag−1(XTXTT),byHadamard’s